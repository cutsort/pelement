-- a table for the mappable pieces.

-- this is only a test implementation.
create table r3_to_r4_mapping ( scaffold varchar(10) not null,
                                r3_start integer not null,
                                r4_start integer not null,
                                length integer not null,
                                orientation integer not null default 1);
grant select on r3_to_r4_mapping to public;

-- only the oriented mummer matches are in this table. maybe I'll
-- put in the flipped matches later.

-- question: do we want some sort of id for the mummer match.
-- that is: suppose I map two coordinates from r3->r4, and I
-- see that 1,234 maps to 2,234 and 1,256 maps to 2,256. This
-- does not mean that every base in between is unchanged. But
-- if we have a mummer id associated with the map of 1,234 to
-- 2,234 and 1,256 to 2,256 and these id were the same, then
-- we would know everything in between is unchanged.

copy r3_to_r4_mapping from stdin;
X	1	92318	600	1
X	701	100085	2606823	1
X	2607524	2706909	220126	1
X	2829950	2927360	716	1
X	2830666	2928384	43780	1
X	2874446	2972165	11013	1
X	2885460	2983178	319766	1
X	3205226	3302945	285557	1
X	3490793	3588514	10431	1
X	3507888	3605862	12176	1
X	3520065	3618038	6717	1
X	3526782	3630351	6521	1
X	3534916	3639527	6428	1
X	3542331	3646952	824016	1
X	4366347	4470971	228561	1
X	4594909	4699532	668098	1
X	5263007	5368350	2222	1
X	5265729	5370591	206807	1
X	5472537	5577398	135891	1
X	5608430	5713290	1353686	1
X	6962117	7066977	4274	1
X	6966392	7071251	520541	1
X	7486934	7591792	69388	1
X	7556496	7663502	334	1
X	7556840	7663846	1115	1
X	7557956	7664962	859	1
X	7559531	7665821	836454	1
X	8396085	8502324	26415	1
X	8422502	8528739	781129	1
X	9203632	9309869	344811	1
X	9548446	9654683	4548	1
X	9553954	9659280	20939	1
X	9574949	9680275	43903	1
X	9618865	9724178	516577	1
X	10135791	10240755	69201	1
X	10204999	10309957	276581	1
X	10481775	10586778	31016	1
X	10514586	10618025	18580	1
X	10533167	10636605	2932	1
X	10536100	10639538	23135	1
X	10559235	10662674	1462	1
X	10561030	10664309	1216888	1
X	11777973	11881250	754203	1
X	12532178	12635453	91929	1
X	12624107	12727384	282770	1
X	12906924	13010198	667	1
X	12907681	13010953	1507	1
X	12909189	13012461	4172	1
X	12914160	13017437	1496	1
X	12916387	13019665	869412	1
X	13785909	13889187	2574	1
X	13788484	13891762	1028	1
X	13789610	13892887	46048	1
X	13835659	13938936	278	1
X	13836334	13939612	147104	1
X	13983442	14086720	28160	1
X	14012577	14114880	293	1
X	14013358	14117607	199	1
X	14013557	14117885	112	1
X	14016389	14118610	245	1
X	14016896	14119819	19302	1
X	14036199	14139122	38714	1
X	14074913	14177837	58528	1
X	14133442	14236365	238211	1
X	14372547	14475469	95193	1
X	14467740	14570663	525439	1
X	14993180	15096103	351878	1
X	15345059	15447982	291132	1
X	15636192	15739114	238	1
X	15636431	15739353	110026	1
X	15746458	15849380	653	1
X	15747979	15850033	220	1
X	15748199	15851126	2041	1
X	15750365	15853292	155	1
X	15750966	15853893	4796	1
X	15755832	15858759	1569	1
X	15757403	15860330	2039	1
X	15759443	15862370	1853	1
X	15761301	15864230	1681	1
X	15762983	15865912	239	1
X	15763223	15866152	6042	1
X	15769266	15872195	34367	1
X	15803644	15906562	58980	1
X	15862655	15965573	5825	1
X	15868481	15971398	193	1
X	15868760	15971678	46278	1
X	15915043	16017961	39419	1
X	15954463	16057381	122593	1
X	16077057	16179974	220808	1
X	16298038	16400955	326742	1
X	16624781	16727697	62673	1
X	16687454	16790432	157721	1
X	16845176	16948154	649626	1
X	17494803	17597781	1015425	1
X	18510228	18613207	195070	1
X	18705299	18808277	128210	1
X	18833510	18936487	224845	1
X	19058356	19161333	4667	1
X	19063024	19166001	582730	1
X	19647117	19784995	668	1
X	19647786	19785664	228359	1
X	19876146	20014024	22319	1
X	19898466	20036344	999	1
X	19899466	20037344	392354	1
X	20291823	20429699	51020	1
X	20342843	20481103	4776	1
X	20347619	20485880	285491	1
X	20633111	20771371	184710	1
X	20817822	20956082	8050	1
X	20825922	20964185	318192	1
X	21144114	21282857	74768	1
X	21218911	21357654	2719	1
X	21221633	21360386	57027	1
X	21280182	21418948	845	1
X	21284659	21423425	27929	1
X	21312601	21451369	12859	1
X	21325460	21464232	3112	1
X	21328573	21467345	8600	1
X	21337173	21557913	100	1
X	21338173	21608727	10178	1
X	21348366	21618905	4909	1
X	21353291	21623831	8676	1
X	21362011	21632552	343	1
X	21362381	21632915	10541	1
X	21372922	21643457	2054	1
X	21374977	21645512	123	1
X	21375101	21645635	72879	1
X	21447980	21718515	8278	1
X	21456751	21726793	89554	1
X	21546305	21816359	200510	1
X	21746821	22016869	1821	1
X	21748643	22018691	31361	1
2L	1	1	341371	1
2L	341372	341373	19010	1
2L	360383	362843	841	1
2L	366237	364222	835	1
2L	367072	365407	637228	1
2L	1004301	1002635	656792	1
2L	1661093	1659428	441004	1
2L	2102097	2109530	458488	1
2L	2560586	2568019	112053	1
2L	2672641	2680072	254181	1
2L	2926823	2934254	1606452	1
2L	4533276	4540707	397918	1
2L	4931833	4939262	236613	1
2L	5168795	5176224	52567	1
2L	5221363	5228792	141126	1
2L	5362489	5370274	1060057	1
2L	6422547	6430331	447074	1
2L	6869622	6877406	963	1
2L	6870932	6878714	298	1
2L	6871422	6879202	235	1
2L	6871868	6879644	562	1
2L	6872790	6880564	668	1
2L	6873541	6881314	249	1
2L	6873791	6881563	210	1
2L	6874102	6881873	374	1
2L	6874477	6882247	223	1
2L	6874897	6882666	847066	1
2L	7721964	7729733	1490066	1
2L	9212460	9220225	261626	1
2L	9474086	9481857	417407	1
2L	9891493	9899474	210	1
2L	9892262	9899853	1954	1
2L	9894217	9901808	143189	1
2L	10037407	10044998	1170130	1
2L	11207620	11218748	33833	1
2L	11241453	11252582	288702	1
2L	11530156	11541285	1023131	1
2L	12553287	12564417	885760	1
2L	13439047	13456896	142355	1
2L	13581592	13599440	48854	1
2L	13630447	13648294	1243	1
2L	13631691	13649538	9318	1
2L	13641913	13659761	959188	1
2L	14601104	14618949	367574	1
2L	14968679	14986523	462261	1
2L	15430940	15448785	1692945	1
2L	17123885	17141731	129587	1
2L	17253765	17271611	86185	1
2L	17339953	17357799	2304488	1
2L	19644693	19662538	549	1
2L	19645407	19663253	70910	1
2L	19716797	19734642	780	1
2L	19717580	19735422	204	1
2L	19717931	19735773	276	1
2L	19718587	19736439	206	1
2L	19718794	19736646	558260	1
2L	20277055	20294906	43943	1
2L	20320999	20338850	95875	1
2L	20418634	20436489	2243	1
2L	20420878	20438736	2031	1
2L	20422910	20440768	1095	1
2L	20426105	20443956	563413	1
2L	20989519	21007369	1475	1
2L	20991537	21008987	409	1
2L	20991946	21009796	356	1
2L	20992426	21010153	213	1
2L	20992859	21010555	274	1
2L	20993541	21011390	392539	1
2L	21387080	21408830	447	1
2L	21387527	21424434	1156	1
2L	21388684	21425591	253	1
2L	21388938	21425845	759	1
2L	21389697	21440645	2444	1
2L	21393041	21473132	699	1
2L	21393741	21473832	489	1
2L	21394230	21530689	1177	1
2L	21395408	21531867	6126	1
2L	21401599	21538058	243	1
2L	21402911	21557393	602	1
2L	21403514	21557995	1670	1
2L	21405185	21559665	4228	1
2L	21409413	21563894	13513	1
2L	21422933	21577407	20651	1
2L	21443639	21598111	2893	1
2L	21446591	21601063	61473	1
2L	21508065	21662537	226529	1
2L	21734597	21889114	328515	1
2L	22063394	22217910	1251	1
2L	22064646	22219161	39952	1
2L	22104808	22259320	3395	1
2L	22108382	22262891	218	1
2L	22108620	22263129	584	1
2L	22109279	22263767	2216	1
2L	22111496	22265984	10456	1
2L	22121962	22276448	12378	1
2L	22134600	22289083	2595	1
2L	22137312	22291794	25456	1
2L	22162769	22317251	55163	1
2R	1	368521	33355	1
2R	33476	401996	121133	1
2R	154610	523130	31848	1
2R	186513	555032	6770	1
2R	193318	561836	5320	1
2R	198639	567157	286300	1
2R	484940	853458	40215	1
2R	525157	893674	14671	1
2R	539829	908346	9167	1
2R	549000	917517	498552	1
2R	1047553	1416073	244509	1
2R	1292062	1660985	151617	1
2R	1443679	1812603	407	1
2R	1444086	1813011	25224	1
2R	1470248	1839173	3470	1
2R	1473719	1842644	185	1
2R	1473905	1842830	2157	1
2R	1476062	1844995	3079	1
2R	1480468	1900145	666	1
2R	1481135	1900812	223	1
2R	1481497	1901174	845	1
2R	1483242	1934146	53495	1
2R	1536839	1987757	541	1
2R	1538062	1988973	226	1
2R	1538289	1989200	17663	1
2R	1556102	2007013	771335	1
2R	2327437	2778349	749833	1
2R	3077270	3528336	1336435	1
2R	4421402	4872584	305	1
2R	4421708	4872889	349401	1
2R	4771110	5222290	16617	1
2R	4787772	5238952	896819	1
2R	5684624	6135804	13882	1
2R	5698507	6149687	27069	1
2R	5725672	6176851	5213	1
2R	5730886	6182064	685838	1
2R	6416724	6867903	311	1
2R	6417035	6868223	23	1
2R	6417059	6868256	63751	1
2R	6481392	6932589	664	1
2R	6482068	6933262	1357756	1
2R	7839825	8291018	1330894	1
2R	9170720	9621913	1475	1
2R	9172195	9623389	162	1
2R	9172416	9623551	95	1
2R	9172512	9623647	233	1
2R	9172745	9623881	82060	1
2R	9254807	9705944	830652	1
2R	10085460	10536597	7050	1
2R	10092510	10543648	942170	1
2R	11034681	11485819	91461	1
2R	11126143	11577281	1929413	1
2R	13055559	13506694	12663	1
2R	13068228	13519357	306535	1
2R	13374766	13825892	574	1
2R	13375343	13826466	53264	1
2R	13434558	13885701	1366161	1
2R	14800756	15251899	19698	1
2R	14821931	15273081	2247	1
2R	14824179	15275329	5182	1
2R	14829362	15280512	194511	1
2R	15023873	15475024	780728	1
2R	15804601	16269539	23077	1
2R	15828578	16292616	412553	1
2R	16241138	16705169	1211740	1
2R	17452879	17916911	2325429	1
2R	19778310	20242340	524446	1
3L	73	2976	8757	1
3L	9178	12078	45088	1
3L	54266	57168	335472	1
3L	389914	392817	639118	1
3L	1029033	1031936	1507566	1
3L	2536600	2539503	495970	1
3L	3032571	3035474	905688	1
3L	3938295	3941198	27189	1
3L	3965485	3968388	107605	1
3L	4073090	4075996	650712	1
3L	4723803	4726709	358750	1
3L	5083553	5098191	77302	1
3L	5160855	5175494	945935	1
3L	6107325	6121743	1792293	1
3L	7899619	7914036	25975	1
3L	7925595	7940011	17217	1
3L	7942813	7957228	37463	1
3L	7980276	7996508	226	1
3L	7980602	7997040	507	1
3L	7982310	7997547	1362513	1
3L	9344823	9361241	5806	1
3L	9350630	9367048	1551900	1
3L	10902533	10918948	724804	1
3L	11627353	11643752	332532	1
3L	11959885	11976285	1277440	1
3L	13237346	13253725	58379	1
3L	13295748	13312127	680689	1
3L	13976438	13992817	799121	1
3L	14775559	14791939	1831493	1
3L	16607053	16623432	643337	1
3L	17250390	17266770	1208082	1
3L	18458473	18474852	19538	1
3L	18478011	18494391	943741	1
3L	19424074	19440454	32838	1
3L	19458412	19473714	322247	1
3L	19780660	19795962	19516	1
3L	19800239	19815541	7555	1
3L	19807794	19823097	864876	1
3L	20672670	20688494	64003	1
3L	20736728	20752551	3140	1
3L	20739868	20756433	1499	1
3L	20741459	20758024	661333	1
3L	21402793	21419357	731	1
3L	21403525	21420088	618864	1
3L	22022390	22038953	120377	1
3L	22142768	22159331	930900	1
3L	23108918	23094411	117	1
3L	23109203	23094696	151	1
3L	23130409	23292976	8367	1
3L	23138920	23301487	336	1
3L	23139257	23301823	3260	1
3L	23142518	23305084	491	1
3L	23143110	23305676	378	1
3L	23143512	23306079	214	1
3L	23143726	23306294	214	1
3L	23144004	23306573	823	1
3L	23144828	23307397	120	1
3L	23144949	23307518	502	1
3L	23145452	23308021	1053	1
3L	23146506	23309075	105	1
3L	23146612	23309181	157	1
3L	23146770	23309339	2599	1
3L	23149396	23311965	105	1
3L	23149513	23312083	374	1
3L	23149888	23312458	501	1
3L	23150964	23313535	3089	1
3L	23154197	23316769	8373	1
3L	23281662	23377410	156	1
3L	23336312	23435008	121	1
3L	23336433	23466810	86	1
3L	23340636	23492989	4613	1
3L	23351553	23501825	634	1
3R	1	1	14367	1
3R	14469	14470	185704	1
3R	200174	200175	517272	1
3R	718462	718465	1127296	1
3R	1845759	1845761	141960	1
3R	1989834	1989834	11716	1
3R	2001551	2001551	245352	1
3R	2246904	2246903	682521	1
3R	2929443	2929424	601332	1
3R	3530776	3530757	5176	1
3R	3535955	3535940	1411498	1
3R	4947454	4947438	161755	1
3R	5109210	5109194	663311	1
3R	5772596	5772578	225248	1
3R	5997845	5997827	106	1
3R	5997952	5997934	633048	1
3R	6631001	6630983	1244856	1
3R	7875858	7875839	1972643	1
3R	9848513	9848494	407305	1
3R	10255818	10255800	284653	1
3R	10540473	10540455	910613	1
3R	11451087	11451069	1198369	1
3R	12649457	12649439	794	1
3R	12650252	12650233	595	1
3R	12650848	12650829	12246	1
3R	12663094	12663076	9773	1
3R	12672867	12672850	1060	1
3R	12673928	12673911	2892	1
3R	12676820	12676804	4935	1
3R	12681755	12681740	11897	1
3R	12693653	12693637	594	1
3R	12694248	12694232	1947	1
3R	12696196	12696180	194	1
3R	12696390	12696375	1293071	1
3R	13989462	13989447	37208	1
3R	14026671	14026655	213864	1
3R	14240543	14240527	191806	1
3R	14432350	14432333	2249660	1
3R	16682011	16681994	444386	1
3R	17126397	17135439	35841	1
3R	17162244	17171280	1106802	1
3R	18269046	18278390	682536	1
3R	18951583	18960926	681409	1
3R	19632996	19642339	1582053	1
3R	21215050	21224392	102	1
3R	21215152	21225787	2268762	1
3R	23483915	23494550	267173	1
3R	23751089	23761723	3398942	1
3R	27150032	27160666	558897	1
3R	27708930	27719564	165769	1
3R	27874703	27885333	10987	1
3R	27886977	27896320	3814	1
4	1	1	228818	1
4	228823	228823	16543	1
4	245366	245878	77354	1
4	322721	323232	488603	1
4	811372	811882	167	1
4	811633	812143	5986	1
4	817619	818281	173072	1
4	990691	991489	82656	1
4	1073363	1074145	91969	1
4	1165332	1166194	42023	1
4	1208255	1220913	102	1
4	1209750	1262662	167	1
4	1211056	1262866	126	1
4	1211583	1263377	268	1
4	1226351	1278145	268	1
\.

-- Create a function that returns a release 4 coordinate give a release 3 coodinate
-- this function is '1' based.

-- this returns a null for any unmappable base. Do we want something else?

create function "r3_r4_map" (character varying,integer) returns integer as '
select r4_start+($2-r3_start)*orientation from r3_to_r4_mapping where
scaffold = $1 and
r3_start <= $2 and
r3_start+length > $2' language 'sql';

-- a function for a release 3 coordinate given a release 4 coordinate

create function "r4_r3_map" (character varying,integer) returns integer as '
select r3_start+($2-r4_start)*orientation from r3_to_r4_mapping where
scaffold = $1 and
r4_start <= $2 and
r4_start+length > $2' language 'sql';

